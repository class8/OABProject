<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oab.client.product.dao.ProductDao">
	<!-- 관리자 페이지 추가 -->
	<sql id="productCommon">
		SELECT pt_number, pt_name,
		pt_price, pt_thumb, pt_image1,
		pt_image2,
		pt_image3
		from product_tbl
		<where>
		 pt_status = '상태' 
			<if test="search == 'pt_name'">
   <![CDATA[and pt_name LIKE '%' || #{keyword} || '%']]>
			</if>
		</where>
	</sql>

	<!-- 게시물 전체 조회 -->
	<select id="productList" parameterType="product"
		resultType="product">
		<!-- product - productList -->
		SELECT pt_number, pt_name,
		pt_price, pt_thumb, pt_image1,
		pt_image2,
		pt_image3
		from
		(SELECT list.*, ROWNUM AS RNUM
		FROM (
		<include refid="productCommon"></include>
		<!-- 상품 목록에 보여질 조건 -->
		<choose>
			<when test="order_by=='pt_name'">
				ORDER BY pt_name
			</when>
			<when test="order_by=='pt_price'">
				ORDER BY pt_price
			</when>
		</choose>
		<choose>
			<when test="order_sc=='ASC'">
				ASC
			</when>
			<when test="order_sc=='DESC'">
				DESC
			</when>
		</choose>
		) list
		)
		<where>
			<if test="start_row != null and start_row != ''">
				<if test="end_row != null and end_row != ''">
					RNUM BETWEEN #{start_row} AND #{end_row}
				</if>
			</if>
		</where>
	</select>

	<select id="productListCnt" parameterType="product"
		resultType="int">
		<!-- Board - boardListCnt -->
		SELECT NVL(count(1), 0) FROM
		(SELECT list.*, ROWNUM AS RNUM
		FROM (
		<include refid="productCommon"></include>
		) list ORDER BY pt_number desc
		)
	</select>

</mapper>
